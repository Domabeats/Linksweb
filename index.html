<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reproductor A/B – Jackie Greene</title>
<style>
  body { margin:0; font-family:system-ui, sans-serif; background:#0f0f0f; color:#eaeaea; display:flex; justify-content:center; align-items:center; height:100vh; }
  .player { background:#161616; border-radius:12px; padding:24px; width:360px; box-shadow:0 10px 30px rgba(0,0,0,.4); }
  .title { font-size:14px; font-weight:600; margin-bottom:4px; }
  .subtitle { font-size:12px; color:#9a9a9a; margin-bottom:16px; }
  .ab-toggle { display:flex; gap:8px; margin-bottom:16px; }
  .ab-toggle button { flex:1; padding:8px 0; border-radius:6px; border:1px solid #333; background:#1f1f1f; color:#aaa; cursor:pointer; font-size:12px; }
  .ab-toggle button.active { background:#f5b427; color:#000; border-color:#f5b427; }
  .timeline { height:4px; background:#2a2a2a; border-radius:2px; margin-bottom:8px; overflow:hidden; cursor:pointer; }
  .progress { height:100%; width:0%; background:#f5b427; }
  .time { display:flex; justify-content:space-between; font-size:11px; color:#9a9a9a; margin-bottom:14px; }
  .controls { display:flex; justify-content:center; gap:12px; }
  .controls button { background:#1f1f1f; border:1px solid #333; color:#eaeaea; width:44px; height:44px; border-radius:50%; font-size:14px; cursor:pointer; }
</style>
</head>
<body>

<div class="player">
  <div class="title">Jackie Greene – Don’t let the devil take your mind</div>
  <div class="subtitle">Comparación educativa</div>

  <div class="ab-toggle">
    <button id="btnA" class="active">ORIGINAL</button>
    <button id="btnB">MEZCLA</button>
  </div>

  <div class="timeline" id="timeline">
    <div class="progress" id="progress"></div>
  </div>

  <div class="time">
    <span id="currentTime">0:00</span>
    <span id="duration">0:00</span>
  </div>

  <div class="controls">
    <button id="playBtn">▶︎</button>
    <button id="pauseBtn">⏸</button>
  </div>
</div>

<script>
const audioAUrl = "https://raw.githubusercontent.com/Domabeats/Linksweb/cf1f954283f6a654bdc0b9800d772eafc39146e4/JackieGreene-DontletthedeviltakeyourmindBEFORE.wav";
const audioBUrl = "https://raw.githubusercontent.com/Domabeats/Linksweb/f0179cbe173aa93f7b1f47b21cd4f08569fd340f/JackieGreene-Dontletthedeviltakeyourmindafter.wav";

const ctx = new (window.AudioContext || window.webkitAudioContext)();

let bufferA, bufferB;
let sourceA, sourceB;
let gainA, gainB;
let startTime = 0;
let pausedAt = 0;
let isPlaying = false;
let audioLoaded = false;

const progressEl = document.getElementById("progress");
const timeline = document.getElementById("timeline");
const currentTimeEl = document.getElementById("currentTime");
const durationEl = document.getElementById("duration");
const btnA = document.getElementById("btnA");
const btnB = document.getElementById("btnB");

function formatTime(sec) {
  const m = Math.floor(sec / 60);
  const s = Math.floor(sec % 60).toString().padStart(2,'0');
  return `${m}:${s}`;
}

async function loadAudio(url) {
  const res = await fetch(url);
  const arrayBuffer = await res.arrayBuffer();
  return await ctx.decodeAudioData(arrayBuffer);
}

function createSources(offset=0) {
  sourceA = ctx.createBufferSource();
  sourceB = ctx.createBufferSource();

  gainA = ctx.createGain();
  gainB = ctx.createGain();

  sourceA.buffer = bufferA;
  sourceB.buffer = bufferB;

  sourceA.connect(gainA).connect(ctx.destination);
  sourceB.connect(gainB).connect(ctx.destination);

  gainA.gain.value = btnA.classList.contains('active') ? 1 : 0;
  gainB.gain.value = btnB.classList.contains('active') ? 1 : 0;

  sourceA.start(0, offset);
  sourceB.start(0, offset);

  startTime = ctx.currentTime - offset;
  isPlaying = true;

  updateProgress();
}

function play() {
  if(isPlaying) return;
  createSources(pausedAt);
}

function pause() {
  if(!isPlaying) return;
  sourceA.stop();
  sourceB.stop();
  pausedAt = ctx.currentTime - startTime;
  isPlaying = false;
}

function updateProgress() {
  if(!isPlaying) return;
  const current = ctx.currentTime - startTime;
  const duration = bufferA.duration;
  const percent = Math.min((current / duration) * 100, 100);
  progressEl.style.width = percent + "%";
  currentTimeEl.textContent = formatTime(current);
  requestAnimationFrame(updateProgress);
}

// SEEK
timeline.addEventListener('click', e => {
  if(!audioLoaded) return;
  const rect = timeline.getBoundingClientRect();
  const percent = (e.clientX - rect.left)/rect.width;
  const newTime = bufferA.duration * percent;
  pausedAt = newTime;

  if(isPlaying) {
    sourceA.stop();
    sourceB.stop();
    isPlaying = false;
    createSources(newTime);
  } else {
    progressEl.style.width = percent*100 + "%";
    currentTimeEl.textContent = formatTime(newTime);
  }
});

// UI
document.getElementById("playBtn").onclick = async () => {
  if(ctx.state === "suspended") await ctx.resume();

  if(!audioLoaded){
    bufferA = await loadAudio(audioAUrl);
    bufferB = await loadAudio(audioBUrl);
    durationEl.textContent = formatTime(bufferA.duration);
    audioLoaded = true;
  }

  play();
};

document.getElementById("pauseBtn").onclick = pause;

btnA.onclick = () => {
  gainA.gain.value = 1;
  gainB.gain.value = 0;
  btnA.classList.add("active");
  btnB.classList.remove("active");
};

btnB.onclick = () => {
  gainA.gain.value = 0;
  gainB.gain.value = 1;
  btnB.classList.add("active");
  btnA.classList.remove("active");
};
</script>

</body>
</html>
